

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Combining multiple Extractors together &#8212; Cambridge Jazz Trio Database</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usage/combining-extractors';</script>
    <link rel="icon" href="../_static/html_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Defining your own Extractor classes" href="define-extractors.html" />
    <link rel="prev" title="Working with Extractor classes" href="feature-extractor.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Cambridge Jazz Trio Database</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../installation/getting-started.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="user-guide.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../src/modules.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../resources/online-resources.html">
                        Resources
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/HuwCheston/Cambridge-Jazz-Trio-Database" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/huwcheston" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../installation/getting-started.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="user-guide.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../src/modules.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../resources/online-resources.html">
                        Resources
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/HuwCheston/Cambridge-Jazz-Trio-Database" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/huwcheston" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Loading data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="loading-data.html">Loading the database in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="onsetmaker-classes.html">Working with `OnsetMaker` classes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Feature extraction</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="feature-extractor.html">Working with `Extractor` classes</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Combining multiple `Extractor` classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="define-extractors.html">Defining new `Extractor` classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="implemented-extractors.html">Currently implemented `Extractor` classes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualising results</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="plotting-workflow.html">General plotting workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualise-performance.html">Visualizing a single performance</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="user-guide.html" class="nav-link">Usage</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Combining...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="combining-multiple-extractors-together">
<h1>Combining multiple <code class="docutils literal notranslate"><span class="pre">Extractor</span></code>s together<a class="headerlink" href="#combining-multiple-extractors-together" title="Permalink to this heading">#</a></h1>
<section id="combine-features-in-one-recording">
<span id="combine-extractors"></span><h2>Combine features in one recording<a class="headerlink" href="#combine-features-in-one-recording" title="Permalink to this heading">#</a></h2>
<p>On the previous page, we explored how we can extract a single feature from one musician’s performance. Usually when we’re building predictive models, however, we want to work with multiple features at the same time. <code class="docutils literal notranslate"><span class="pre">Extractor</span></code>s can be combined very easily by joining several of their <code class="docutils literal notranslate"><span class="pre">summary_dict</span></code>s together.</p>
<p>Let’s assume we’ve already defined both the <code class="docutils literal notranslate"><span class="pre">bur_extract</span></code> and <code class="docutils literal notranslate"><span class="pre">async_extract</span></code> classes from the code on the previous page. To join these together, we can simply write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">big_dict</span> <span class="o">=</span> <span class="n">bur_extract</span><span class="o">.</span><span class="n">summary_dict</span> <span class="o">|</span> <span class="n">async_extract</span><span class="o">.</span><span class="n">summary_dict</span>
<span class="n">big_dict</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>     <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>     <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">}</span>   
</pre></div>
</div>
</section>
<section id="combine-features-across-several-recordings">
<h2>Combine features across several recordings<a class="headerlink" href="#combine-features-across-several-recordings" title="Permalink to this heading">#</a></h2>
<p>Now that we know how to combine several features together for a single recording, the logical next step is to consider how we can combine features across a number of tracks. In the following blocks of code, we’ll assume that <code class="docutils literal notranslate"><span class="pre">res</span></code> is a list of <code class="docutils literal notranslate"><span class="pre">OnsetMaker</span></code> classes created by unserialising the output of <code class="docutils literal notranslate"><span class="pre">.\src\detect\detect_onsets.py</span></code>: see <a class="reference internal" href="loading-data.html#load-from-src"><span class="std std-ref">loading data from source</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">track</span><span class="p">:</span> <span class="n">OnsetMaker</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts features for a single track and combines `summary_dict`s&quot;&quot;&quot;</span>
    <span class="c1"># Extract the necessary timing data from the track</span>
    <span class="n">beats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">summary_dict</span><span class="p">)</span>
    <span class="n">my_beats</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="s1">&#39;piano&#39;</span><span class="p">]</span>
    <span class="n">my_onsets</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">ons</span><span class="p">[</span><span class="s1">&#39;piano&#39;</span><span class="p">]</span>
    <span class="n">their_beats</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[[</span><span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]]</span>
    <span class="c1"># Extract burs for this track</span>
    <span class="n">bur_extract_one</span> <span class="o">=</span> <span class="n">BeatUpbeatRatio</span><span class="p">(</span><span class="n">my_onsets</span><span class="p">,</span> <span class="n">my_beats</span><span class="p">)</span>
    <span class="c1"># Extract asynchrony for this track</span>
    <span class="n">async_extract_one</span> <span class="o">=</span> <span class="n">Asynchrony</span><span class="p">(</span><span class="n">my_beats</span><span class="p">,</span> <span class="n">their_beats</span><span class="p">)</span>
    <span class="c1"># Combine features and return one dictionary</span>
    <span class="k">return</span> <span class="n">bur_extract_one</span><span class="o">.</span><span class="n">summary_dict</span> <span class="o">|</span> 
           <span class="n">async_extract_one</span><span class="o">.</span><span class="n">summary_dict</span>


<span class="c1"># Iterate through every individual track and build an array</span>
<span class="n">all_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_features</span><span class="p">(</span><span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
<span class="n">all_features</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">]</span>
</pre></div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">all_features</span></code> isn’t especially useful to us in its current state, however: it’d be better to turn this into a DataFrame by calling <code class="docutils literal notranslate"><span class="pre">pd.DataFrame(all_features)</span></code>.</p>
</section>
<section id="combining-features-with-metadata">
<h2>Combining features with metadata<a class="headerlink" href="#combining-features-with-metadata" title="Permalink to this heading">#</a></h2>
<p>In the above example, every row is a track, and every column is a feature. But it can be hard to tell just <em>which</em> row corresponds to <em>which</em> track. To make this easier, we’d suggest combining your extracted features with additional metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">features_with_metadata</span><span class="p">(</span><span class="n">track</span><span class="p">:</span> <span class="n">OnsetMaker</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combines `extract_features` results with metadata&quot;&quot;&quot;</span>   
    <span class="c1"># Define the list of metadata keys we want to extract</span>
    <span class="n">desired_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;track_name&#39;</span><span class="p">,</span> <span class="s1">&#39;album_name&#39;</span><span class="p">,</span> <span class="s1">&#39;recording_year&#39;</span><span class="p">]</span>
    <span class="c1"># Create a new dictionary of desired metadata values</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">track</span><span class="o">.</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">desired_keys</span><span class="p">}</span>
    <span class="c1"># Combine metadata with the results from `extract_features`</span>
    <span class="k">return</span> <span class="n">metadata</span> <span class="o">|</span> <span class="n">extract_features</span><span class="p">(</span><span class="n">track</span><span class="p">)</span>
    
    
<span class="c1"># Iterate through every individual track and build an array</span>
<span class="n">all_features_with_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_features</span><span class="p">(</span><span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;track_name&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;album_name&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;track_name&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;album_name&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="combine-features-for-multiple-performers">
<h2>Combine features for multiple performers<a class="headerlink" href="#combine-features-for-multiple-performers" title="Permalink to this heading">#</a></h2>
<p>In the above example, we were only interested in the performance of the piano player. But what if, for instance, we wanted to know about the bassist’s level of swing as well, alongside their synchronization with the piano and drums? To do so, we need to iterate over the names of individual instruments as well as the data from each track. For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_instrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;piano&#39;</span><span class="p">,</span> <span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">extract_features_for_instrument</span><span class="p">(</span><span class="n">track</span><span class="p">:</span> <span class="n">OnsetMaker</span><span class="p">,</span> <span class="n">my_instr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts features for a single track and combines `summary_dict`s&quot;&quot;&quot;</span>
    <span class="c1"># Get the names of all other instruments in the ensemble</span>
    <span class="n">their_instrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ins</span> <span class="k">for</span> <span class="n">ins</span> <span class="ow">in</span> <span class="n">all_instrs</span> <span class="k">if</span> <span class="n">ins</span> <span class="o">!=</span> <span class="n">my_instr</span><span class="p">]</span>
    <span class="c1"># Extract the necessary timing data from the track</span>
    <span class="n">beats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">summary_dict</span><span class="p">)</span>
    <span class="n">my_beats</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">my_instr</span><span class="p">]</span>
    <span class="n">my_onsets</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">ons</span><span class="p">[</span><span class="n">my_instr</span><span class="p">]</span>
    <span class="n">their_beats</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">their_instrs</span><span class="p">]</span>
    <span class="c1"># Extract burs for this track</span>
    <span class="n">bur_extract_one</span> <span class="o">=</span> <span class="n">BeatUpbeatRatio</span><span class="p">(</span><span class="n">my_onsets</span><span class="p">,</span> <span class="n">my_beats</span><span class="p">)</span>
    <span class="c1"># Extract asynchrony for this track</span>
    <span class="n">async_extract_one</span> <span class="o">=</span> <span class="n">Asynchrony</span><span class="p">(</span><span class="n">my_beats</span><span class="p">,</span> <span class="n">their_beats</span><span class="p">)</span>
    <span class="c1"># Combine features and return one dictionary</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;instr&#39;</span><span class="p">:</span> <span class="n">my_instr</span><span class="p">}</span> <span class="o">|</span> 
           <span class="n">bur_extract_one</span><span class="o">.</span><span class="n">summary_dict</span> <span class="o">|</span> 
           <span class="n">async_extract_one</span><span class="o">.</span><span class="n">summary_dict</span>


<span class="c1"># Iterate through every individual track and build an array</span>
<span class="n">all_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">all_instrs</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">extract_features_for_instrument</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">instr</span><span class="p">)</span>
        <span class="n">all_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">all_features</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;instr&#39;</span><span class="p">:</span> <span class="s1">&#39;piano&#39;</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;instr&#39;</span><span class="p">:</span> <span class="s1">&#39;bass&#39;</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;bur_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_mean&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;piano_async_median&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="s1">&#39;instr&#39;</span><span class="p">:</span> <span class="s1">&#39;drums&#39;</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span>         <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="o">...</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">]</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="feature-extractor.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Working with <code class="docutils literal notranslate"><span class="pre">Extractor</span></code> classes</p>
      </div>
    </a>
    <a class="right-next"
       href="define-extractors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Defining your own <code class="docutils literal notranslate"><span class="pre">Extractor</span></code> classes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-features-in-one-recording">Combine features in one recording</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-features-across-several-recordings">Combine features across several recordings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-features-with-metadata">Combining features with metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-features-for-multiple-performers">Combine features for multiple performers</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/usage/combining-extractors.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright Huw Cheston 2024.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>